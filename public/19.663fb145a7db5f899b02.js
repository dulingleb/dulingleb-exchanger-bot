(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{iD7u:function(e,t,r){"use strict";r.r(t),r.d(t,"UsersModule",function(){return C});var s=r("ofXK"),n=r("sYmb"),a=r("NFeN"),i=r("bTqV"),o=r("kmnG"),b=r("1jcm"),c=r("qFsG"),l=r("3Pt+"),u=r("4evo"),d=r("ULOc"),m=r("ir1t"),p=r("tyNb"),f=r("5+tZ"),h=r("nYR2"),D=r("1G5W"),g=r("XNiG"),U=r("i/bw"),T=r("fXoL"),v=r("FwLO"),I=r("Pfez"),y=r("Kbm1");let E=(()=>{class e{constructor(e,t,r,s){this.router=e,this.route=t,this.uiFacade=r,this.telegramUserApiService=s,this.errors={},this.destroy$=new g.a,this.form=new l.f({discount:new l.d("",[l.r.min(0),l.r.max(100)]),comment:new l.d(""),ban:new l.d("")})}ngOnInit(){this.route.paramMap.pipe(Object(f.a)(e=>this.telegramUserApiService.getUser(+e.get("id"))),Object(h.a)(()=>this.inRequest=!1),Object(D.a)(this.destroy$)).subscribe(e=>{this.user=e,this.form.patchValue({discount:e.discount,comment:e.comment,ban:e.ban})},e=>this.uiFacade.addErrorNotification(e.message))}save(){this.inRequest=!0;const e=this.form.get("discount").value,t=this.form.get("comment").value,r=this.form.get("ban").value;this.telegramUserApiService.updateUser({id:this.user.id,discount:e,comment:t,ban:r}).pipe(Object(h.a)(()=>this.inRequest=!1),Object(D.a)(this.destroy$)).subscribe(e=>this.router.navigateByUrl("/users"),e=>this.showError(e))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}showError(e){var t;this.inRequest=!1,this.errors=(null==e?void 0:e.errors)||{};for(const r of Object.keys(this.errors))null===(t=this.form.get(r))||void 0===t||t.setErrors({valid:!1});this.uiFacade.addErrorNotification(e.message)}}return e.\u0275fac=function(t){return new(t||e)(T.Ob(p.f),T.Ob(p.a),T.Ob(U.f),T.Ob(v.f))},e.\u0275cmp=T.Ib({type:e,selectors:[["app-user-edit"]],decls:90,vars:56,consts:[["header",""],["content",""],[1,"wrapper"],[1,"info-table-block"],[1,"item"],[1,"title"],[1,"value"],["href",""],[1,"edit-info-block"],[1,"form",3,"formGroup","ngSubmit"],[1,"form-group"],["appearance","fill"],["formControlName","discount","type","number","min","0","max","100","step","0.5","matInput",""],["name","discount",3,"errors"],["formControlName","comment","matInput",""],["name","comment",3,"errors"],["labelPosition","before","color","primary","formControlName","ban"],["mat-raised-button","","color","primary",3,"disabled"]],template:function(e,t){1&e&&(T.Ub(0,"app-page-content"),T.Sb(1,0),T.Dc(2),T.gc(3,"translate"),T.Ub(4,"i"),T.Dc(5),T.Tb(),T.Rb(),T.Sb(6,1),T.Ub(7,"div",2),T.Ub(8,"section",3),T.Ub(9,"div",4),T.Ub(10,"p",5),T.Dc(11),T.gc(12,"translate"),T.Tb(),T.Ub(13,"p",6),T.Dc(14),T.Tb(),T.Tb(),T.Ub(15,"div",4),T.Ub(16,"p",5),T.Dc(17),T.gc(18,"translate"),T.Tb(),T.Ub(19,"p",6),T.Dc(20),T.Tb(),T.Tb(),T.Ub(21,"div",4),T.Ub(22,"p",5),T.Dc(23),T.gc(24,"translate"),T.Tb(),T.Ub(25,"p",6),T.Dc(26),T.Tb(),T.Tb(),T.Ub(27,"div",4),T.Ub(28,"p",5),T.Dc(29),T.gc(30,"translate"),T.Tb(),T.Ub(31,"p",6),T.Ub(32,"a",7),T.Dc(33),T.Tb(),T.Tb(),T.Tb(),T.Ub(34,"div",4),T.Ub(35,"p",5),T.Dc(36),T.gc(37,"translate"),T.Tb(),T.Ub(38,"p",6),T.Dc(39),T.Tb(),T.Tb(),T.Ub(40,"div",4),T.Ub(41,"p",5),T.Dc(42),T.gc(43,"translate"),T.Tb(),T.Ub(44,"p",6),T.Dc(45),T.Tb(),T.Tb(),T.Ub(46,"div",4),T.Ub(47,"p",5),T.Dc(48),T.gc(49,"translate"),T.Tb(),T.Ub(50,"p",6),T.Dc(51),T.Tb(),T.Tb(),T.Ub(52,"div",4),T.Ub(53,"p",5),T.Dc(54),T.gc(55,"translate"),T.Tb(),T.Ub(56,"p",6),T.Dc(57),T.Tb(),T.Tb(),T.Ub(58,"div",4),T.Ub(59,"p",5),T.Dc(60),T.gc(61,"translate"),T.Tb(),T.Ub(62,"p",6),T.Dc(63),T.Tb(),T.Tb(),T.Tb(),T.Ub(64,"div",8),T.Ub(65,"form",9),T.bc("ngSubmit",function(){return t.save()}),T.Ub(66,"div",10),T.Ub(67,"mat-form-field",11),T.Ub(68,"mat-label"),T.Dc(69),T.gc(70,"translate"),T.Tb(),T.Pb(71,"input",12),T.Ub(72,"mat-error"),T.Pb(73,"app-input-error",13),T.Tb(),T.Tb(),T.Tb(),T.Ub(74,"div",10),T.Ub(75,"mat-form-field",11),T.Ub(76,"mat-label"),T.Dc(77),T.gc(78,"translate"),T.Tb(),T.Pb(79,"textarea",14),T.Ub(80,"mat-error"),T.Pb(81,"app-input-error",15),T.Tb(),T.Tb(),T.Tb(),T.Ub(82,"div",10),T.Ub(83,"mat-slide-toggle",16),T.Ub(84,"mat-label"),T.Dc(85),T.gc(86,"translate"),T.Tb(),T.Tb(),T.Tb(),T.Ub(87,"button",17),T.Dc(88),T.gc(89,"translate"),T.Tb(),T.Tb(),T.Tb(),T.Tb(),T.Rb(),T.Tb()),2&e&&(T.Db(2),T.Fc(" ",T.hc(3,28,"user.edit.pageTitle")," "),T.Db(3),T.Ec(null==t.user?null:t.user.username),T.Db(6),T.Ec(T.hc(12,30,"user.info.id")),T.Db(3),T.Ec(null==t.user?null:t.user.id),T.Db(3),T.Ec(T.hc(18,32,"user.info.username")),T.Db(3),T.Ec(null==t.user?null:t.user.username),T.Db(3),T.Ec(T.hc(24,34,"user.info.name")),T.Db(3),T.Ec(((null==t.user?null:t.user.firstName)||"")+" "+((null==t.user?null:t.user.lastName)||"")),T.Db(3),T.Ec(T.hc(30,36,"user.info.operationsCount")),T.Db(4),T.Ec(null==t.user?null:t.user.operationsCount),T.Db(3),T.Ec(T.hc(37,38,"user.info.operationsSum")),T.Db(3),T.Ec(null==t.user?null:t.user.operationsSum),T.Db(3),T.Ec(T.hc(43,40,"user.info.refCount")),T.Db(3),T.Ec(null==t.user?null:t.user.refCount),T.Db(3),T.Ec(T.hc(49,42,"user.info.refActiveCount")),T.Db(3),T.Ec(null==t.user?null:t.user.refActiveCount),T.Db(3),T.Ec(T.hc(55,44,"user.info.refOperationsCount")),T.Db(3),T.Ec(null==t.user?null:t.user.refOperationsCount),T.Db(3),T.Ec(T.hc(61,46,"user.info.refOperationsSum")),T.Db(3),T.Ec(null==t.user?null:t.user.refOperationsSum),T.Db(2),T.lc("formGroup",t.form),T.Db(4),T.Ec(T.hc(70,48,"user.edit.input.discount")),T.Db(4),T.lc("errors",t.errors),T.Db(4),T.Ec(T.hc(78,50,"user.edit.input.comment")),T.Db(4),T.lc("errors",t.errors),T.Db(4),T.Ec(T.hc(86,52,"user.edit.input.ban")),T.Db(2),T.lc("disabled",t.form.invalid||t.inRequest),T.Db(1),T.Ec(T.hc(89,54,"user.edit.save")))},directives:[I.a,l.s,l.m,l.g,o.c,o.f,l.c,l.p,c.b,l.l,l.e,o.b,y.a,b.a,i.b],pipes:[n.c],styles:[".wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);grid-column-gap:1.5rem}"]}),e})();var N=r("zp1y"),R=r("uhkJ"),S=r("sKXY");const w=[{name:"username",nameI18n:"users.table.username",type:S.g.STRING,sort:!0,allowedForRoles:[U.d.SUPER_ADMIN,U.d.ADMIN]},{name:"operationsCount",nameI18n:"users.table.operationsCount",type:S.g.STRING,sort:!0,allowedForRoles:[U.d.SUPER_ADMIN,U.d.ADMIN]},{name:"operationsSum",nameI18n:"users.table.operationsSum",type:S.g.STRING,sort:!0,allowedForRoles:[U.d.SUPER_ADMIN,U.d.ADMIN]},{name:"discount",nameI18n:"users.table.discount",type:S.g.STRING,sort:!0,allowedForRoles:[U.d.SUPER_ADMIN,U.d.ADMIN]},{name:"ban",nameI18n:"users.table.ban",type:S.g.STRING,icon:e=>e.ban?"clear":"done",class:e=>e.ban?"text-warn":"text-accent",allowedForRoles:[U.d.SUPER_ADMIN,U.d.ADMIN]},{name:"edit",nameI18n:"table.action.edit",type:S.g.STRING,actionData:{link:e=>`/users/${e.id}/edit`,actionType:S.f.LINK,eventType:S.e.INFO},allowedForRoles:[U.d.SUPER_ADMIN,U.d.ADMIN]}];var F=r("7FcC");const O=[{path:"",component:(()=>{class e{constructor(e,t,r){this.adminFacade=e,this.uiFacade=t,this.adminApiService=r,this.users=[],this.tableColumns=w,this.destroy$=new g.a}ngOnInit(){this.initFilterFields()}getAdminList(e){this.inRequest=!0,this.adminApiService.getList(e).pipe(Object(N.a)(this.adminFacade.admin$),Object(h.a)(()=>this.inRequest=!1),Object(D.a)(this.destroy$)).subscribe(([e,t])=>{this.users=e.data,this.paginator={length:e.total,page:e.currentPage,pageSize:e.pageSize}},e=>this.uiFacade.addErrorNotification(e.message))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initFilterFields(){this.filterFields=[{labelI18n:"users.table.username",name:"username",type:R.a.INPUT},{labelI18n:"users.table.discount",name:"discount",type:R.a.INPUT},{labelI18n:"users.table.ban",name:"ban",type:R.a.SELECT,options:[{value:!1,titleI18n:"user.ban.0",class:"text-accent"},{value:!0,titleI18n:"user.ban.1",class:"text-warn"}]}]}}return e.\u0275fac=function(t){return new(t||e)(T.Ob(U.a),T.Ob(U.f),T.Ob(v.f))},e.\u0275cmp=T.Ib({type:e,selectors:[["app-users"]],decls:4,vars:8,consts:[[3,"tableColumns","inRequest","items","filterFields","paginator","getList"],["table-title",""]],template:function(e,t){1&e&&(T.Ub(0,"app-page-content-table",0),T.bc("getList",function(e){return t.getAdminList(e)}),T.Sb(1,1),T.Dc(2),T.gc(3,"translate"),T.Rb(),T.Tb()),2&e&&(T.lc("tableColumns",t.tableColumns)("inRequest",t.inRequest)("items",t.users)("filterFields",t.filterFields)("paginator",t.paginator),T.Db(2),T.Fc(" ",T.hc(3,6,"users.tableHeader.title")," "))},directives:[F.a],pipes:[n.c],encapsulation:2}),e})()},{path:":id/edit",component:E}];let A=(()=>{class e{}return e.\u0275mod=T.Mb({type:e}),e.\u0275inj=T.Lb({factory:function(t){return new(t||e)},imports:[[p.i.forChild(O)],p.i]}),e})(),C=(()=>{class e{}return e.\u0275mod=T.Mb({type:e}),e.\u0275inj=T.Lb({factory:function(t){return new(t||e)},imports:[[s.c,n.b,l.q,a.b,i.c,b.b,o.e,c.c,d.a,u.a,A,m.a]]}),e})()}}]);