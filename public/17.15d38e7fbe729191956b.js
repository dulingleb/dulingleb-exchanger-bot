(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{EbGA:function(e,t,s){"use strict";s.r(t),s.d(t,"SettingsMessagesModule",function(){return P});var i=s("ofXK"),a=s("3Pt+"),r=s("bTqV"),n=s("kmnG"),o=s("NFeN"),c=s("qFsG"),l=s("sYmb"),b=s("ir1t"),g=s("+dTB"),m=s("xoVn"),u=s("ULOc"),d=s("4evo"),p=s("tyNb"),h=s("yK//"),f=s("5+tZ"),v=s("1G5W"),D=s("XNiG"),T=s("LRne"),y=s("i/bw"),w=s("fXoL"),R=s("FwLO"),S=s("Pfez"),O=s("Kbm1"),I=s("KVI4");let M=(()=>{class e{constructor(e,t,s,i){this.router=e,this.route=t,this.uiFacade=s,this.settingApiService=i,this.errors={},this.destroy$=new D.a,this.form=new a.f({title:new a.d(""),slug:new a.d(""),description:new a.d(""),text:new a.d("")})}ngOnInit(){this.inRequest=!0,this.route.paramMap.pipe(Object(f.a)(e=>{const t=+e.get("id");return t?this.settingApiService.getMessageTemplate(t):Object(T.a)({})}),Object(v.a)(this.destroy$)).subscribe(e=>{this.inRequest=!1,this.message=e,this.form.patchValue({title:e.title,slug:e.slug,description:e.description,text:e.text})},e=>this.showError(e))}save(){const e=this.form.get("title").value,t=this.form.get("slug").value,s=this.form.get("description").value,i=this.form.get("text").value,a=Object.assign(Object.assign({},this.message),{title:e,slug:t,description:s,text:i});this.message.id?this.updateMessageTemplate(a):this.addMessageTemplate(a)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}addMessageTemplate(e){this.inRequest=!0,this.settingApiService.addMessageTemplate(e).subscribe(e=>this.showSuccess(e),e=>this.showError(e))}updateMessageTemplate(e){this.inRequest=!0,this.settingApiService.updateMessageTemplate(e).subscribe(e=>this.showSuccess(e),e=>this.showError(e))}showSuccess(e){this.router.navigateByUrl("/settings/messages"),this.uiFacade.addInfoNotification(e.message)}showError(e){var t;this.inRequest=!1,this.errors=(null==e?void 0:e.errors)||{};for(const s of Object.keys(this.errors))null===(t=this.form.get(s))||void 0===t||t.setErrors({valid:!1});this.uiFacade.addErrorNotification(e.message)}}return e.\u0275fac=function(t){return new(t||e)(w.Ob(p.f),w.Ob(p.a),w.Ob(y.f),w.Ob(R.e))},e.\u0275cmp=w.Ib({type:e,selectors:[["app-setting-message-template-edit"]],decls:38,vars:25,consts:[["header",""],["content",""],[1,"form",3,"formGroup","ngSubmit"],[1,"form-group"],["appearance","fill"],["formControlName","title","type","text","matInput",""],["name","title",3,"errors"],["formControlName","slug","type","text","matInput",""],["name","slug",3,"errors"],["formControlName","description","matInput",""],["name","description",3,"errors"],["formControlName","text",3,"label","height"],["mat-raised-button","","color","primary",3,"disabled"]],template:function(e,t){1&e&&(w.Ub(0,"app-page-content"),w.Sb(1,0),w.Dc(2),w.gc(3,"translate"),w.Ub(4,"i"),w.Dc(5),w.Tb(),w.Rb(),w.Sb(6,1),w.Ub(7,"form",2),w.bc("ngSubmit",function(){return t.save()}),w.Ub(8,"div",3),w.Ub(9,"mat-form-field",4),w.Ub(10,"mat-label"),w.Dc(11),w.gc(12,"translate"),w.Tb(),w.Pb(13,"input",5),w.Ub(14,"mat-error"),w.Pb(15,"app-input-error",6),w.Tb(),w.Tb(),w.Tb(),w.Ub(16,"div",3),w.Ub(17,"mat-form-field",4),w.Ub(18,"mat-label"),w.Dc(19),w.gc(20,"translate"),w.Tb(),w.Pb(21,"input",7),w.Ub(22,"mat-error"),w.Pb(23,"app-input-error",8),w.Tb(),w.Tb(),w.Tb(),w.Ub(24,"div",3),w.Ub(25,"mat-form-field",4),w.Ub(26,"mat-label"),w.Dc(27),w.gc(28,"translate"),w.Tb(),w.Pb(29,"textarea",9),w.Ub(30,"mat-error"),w.Pb(31,"app-input-error",10),w.Tb(),w.Tb(),w.Tb(),w.Ub(32,"div",3),w.Pb(33,"app-format-editor",11),w.gc(34,"translate"),w.Tb(),w.Ub(35,"button",12),w.Dc(36),w.gc(37,"translate"),w.Tb(),w.Tb(),w.Rb(),w.Tb()),2&e&&(w.Db(2),w.Fc(" ",w.hc(3,13,null!=t.message&&t.message.id?"settings.messages.template.edit.pageTitle":"settings.messages.template.new.pageTitle")," "),w.Db(3),w.Ec(null==t.message?null:t.message.title),w.Db(2),w.lc("formGroup",t.form),w.Db(4),w.Ec(w.hc(12,15,"settings.messages.edit.input.title")),w.Db(4),w.lc("errors",t.errors),w.Db(4),w.Ec(w.hc(20,17,"settings.messages.edit.input.slug")),w.Db(4),w.lc("errors",t.errors),w.Db(4),w.Ec(w.hc(28,19,"settings.messages.edit.input.description")),w.Db(4),w.lc("errors",t.errors),w.Db(2),w.lc("label",w.hc(34,21,"settings.messages.edit.input.text"))("height",300),w.Db(2),w.lc("disabled",t.form.invalid||t.inRequest),w.Db(1),w.Ec(w.hc(37,23,"settings.messages.edit.saveBtn")))},directives:[S.a,a.s,a.m,a.g,n.c,n.f,a.c,c.b,a.l,a.e,n.b,O.a,I.a,r.b],pipes:[l.c],encapsulation:2}),e})();var U=s("nYR2");let E=(()=>{class e{constructor(e,t,s,i){this.router=e,this.route=t,this.uiFacade=s,this.settingApiService=i,this.errors={},this.destroy$=new D.a,this.form=new a.f({text:new a.d("")})}ngOnInit(){this.inRequest=!0,this.route.paramMap.pipe(Object(f.a)(e=>this.settingApiService.getMessage(e.get("slug")).pipe(Object(U.a)(()=>this.inRequest=!1),Object(v.a)(this.destroy$))),Object(v.a)(this.destroy$)).subscribe(e=>{this.message=e,this.form.patchValue({text:e.text})},e=>this.showError(e))}save(){this.inRequest=!0;const e=this.form.get("text").value;this.settingApiService.updateMessage(this.message.id,e).pipe(Object(U.a)(()=>this.inRequest=!1),Object(v.a)(this.destroy$)).subscribe(e=>this.showSuccess(e),e=>this.showError(e))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}showSuccess(e){this.router.navigateByUrl("/settings/messages"),this.uiFacade.addInfoNotification(e.message)}showError(e){var t;this.inRequest=!1,this.errors=(null==e?void 0:e.errors)||{};for(const s of Object.keys(this.errors))null===(t=this.form.get(s))||void 0===t||t.setErrors({valid:!1});this.uiFacade.addErrorNotification(e.message)}}return e.\u0275fac=function(t){return new(t||e)(w.Ob(p.f),w.Ob(p.a),w.Ob(y.f),w.Ob(R.e))},e.\u0275cmp=w.Ib({type:e,selectors:[["app-setting-message-edit"]],decls:20,vars:18,consts:[["header",""],["content",""],[1,"form",3,"formGroup","ngSubmit"],[3,"innerHTML"],[1,"form-group"],["formControlName","text",3,"label","height"],["name","text",3,"errors"],["mat-raised-button","","color","primary",3,"disabled"]],template:function(e,t){1&e&&(w.Ub(0,"app-page-content"),w.Sb(1,0),w.Dc(2),w.gc(3,"translate"),w.Ub(4,"i"),w.Dc(5),w.Tb(),w.Rb(),w.Sb(6,1),w.Ub(7,"form",2),w.bc("ngSubmit",function(){return t.save()}),w.Ub(8,"h3"),w.Dc(9),w.gc(10,"translate"),w.Tb(),w.Pb(11,"p",3),w.Ub(12,"div",4),w.Pb(13,"app-format-editor",5),w.gc(14,"translate"),w.Ub(15,"mat-error"),w.Pb(16,"app-input-error",6),w.Tb(),w.Tb(),w.Ub(17,"button",7),w.Dc(18),w.gc(19,"translate"),w.Tb(),w.Tb(),w.Rb(),w.Tb()),2&e&&(w.Db(2),w.Fc(" ",w.hc(3,10,"settings.messages.edit.pageTitle")," "),w.Db(3),w.Ec(null==t.message?null:t.message.slug),w.Db(2),w.lc("formGroup",t.form),w.Db(2),w.Ec(w.hc(10,12,"settings.messages.edit.input.description")),w.Db(2),w.lc("innerHTML",null==t.message?null:t.message.description,w.wc),w.Db(2),w.lc("label",w.hc(14,14,"settings.messages.edit.input.text"))("height",300),w.Db(3),w.lc("errors",t.errors),w.Db(1),w.lc("disabled",t.form.invalid||t.inRequest),w.Db(1),w.Ec(w.hc(19,16,"settings.messages.edit.saveBtn")))},directives:[S.a,a.s,a.m,a.g,I.a,a.l,a.e,n.b,O.a,r.b],pipes:[l.c],encapsulation:2}),e})();var F=s("pLZG"),N=s("vkgz"),q=s("sKXY");const A=[{name:"title",nameI18n:"settings.messages.table.title",type:q.g.STRING,allowedForRoles:[y.d.SUPER_ADMIN,y.d.ADMIN]},{name:"slug",nameI18n:"settings.messages.table.slug",type:q.g.STRING,allowedForRoles:[y.d.SUPER_ADMIN,y.d.ADMIN]},{name:"info",nameI18n:"table.action.info",type:q.g.STRING,actionData:{link:e=>`/settings/messages/${null==e?void 0:e.slug}/edit`,actionType:q.f.LINK,eventType:q.e.EDIT},allowedForRoles:[y.d.SUPER_ADMIN,y.d.ADMIN]},{name:"edit",nameI18n:"table.action.edit",type:q.g.STRING,actionData:{icon:"backup_table",link:e=>`/settings/messages/template/${null==e?void 0:e.id}/edit`,actionType:q.f.LINK,eventType:q.e.EDIT},allowedForRoles:[y.d.SUPER_ADMIN]}];var j=s("7FcC");function x(e,t){1&e&&(w.Sb(0,3),w.Ub(1,"a",4),w.Ub(2,"mat-icon"),w.Dc(3,"add"),w.Tb(),w.Ub(4,"span"),w.Dc(5),w.gc(6,"translate"),w.Tb(),w.Tb(),w.Rb()),2&e&&(w.Db(5),w.Ec(w.hc(6,1,"settings.messages.tableHeader.addBtn")))}const $=[{path:"",component:(()=>{class e{constructor(e,t,s,i,a){this.router=e,this.adminFacade=t,this.uiFacade=s,this.confirmModalService=i,this.settingApiService=a,this.messages=[],this.tableColumns=A,this.EUserRoleDto=y.d,this.destroy$=new D.a}ngOnInit(){this.initFilterFields()}getSettingMessageList(e=this.requestApiQuery){this.requestApiQuery=e,this.inRequest=!0,this.settingApiService.getMessageList(e).pipe(Object(U.a)(()=>this.inRequest=!1),Object(v.a)(this.destroy$)).subscribe(e=>{this.messages=e.data,this.paginator={length:e.total,page:e.currentPage,pageSize:e.pageSize}},e=>this.uiFacade.addErrorNotification(e.message))}setEventData(e){e.event===q.e.DELETE&&this.deleteMessage(e.data)}eventMessage(e){this.router.navigate(["settings/messages",e.slug,"edit"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}deleteMessage(e){this.confirmModalService.openDialog({titleI18n:"confirm.deleteModal.title",titleKeyI18n:e.slug,messageI18n:"confirm.deleteModal.message",messageKeyI18n:`${e.slug} (${e.title})`,confirmBtn:!0,cancelBtn:!0}).pipe(Object(F.a)(e=>e),Object(N.a)(()=>this.inRequest=!0),Object(f.a)(()=>this.settingApiService.deleteMessageTemplate(e.id)),Object(U.a)(()=>this.inRequest=!1),Object(v.a)(this.destroy$)).subscribe(()=>{this.messages=this.messages.filter(t=>t.id!==e.id),this.getSettingMessageList()},e=>this.uiFacade.addErrorNotification(e.message))}initFilterFields(){this.filterFields=[{labelI18n:"settings.messages.table.title",name:"title"}]}}return e.\u0275fac=function(t){return new(t||e)(w.Ob(p.f),w.Ob(y.a),w.Ob(y.f),w.Ob(g.b),w.Ob(R.e))},e.\u0275cmp=w.Ib({type:e,selectors:[["app-setting-messages"]],decls:6,vars:11,consts:[[3,"tableColumns","inRequest","items","filterFields","paginator","getList","eventData","eventRow"],["table-title",""],["table-actions","",4,"ngIf"],["table-actions",""],["mat-raised-button","","color","primary","disableRipple","true","routerLink","/settings/messages/template/new",1,"nav-link"]],template:function(e,t){if(1&e&&(w.Ub(0,"app-page-content-table",0),w.bc("getList",function(e){return t.getSettingMessageList(e)})("eventData",function(e){return t.setEventData(e)})("eventRow",function(e){return t.eventMessage(e)}),w.Sb(1,1),w.Dc(2),w.gc(3,"translate"),w.Rb(),w.Cc(4,x,7,3,"ng-container",2),w.gc(5,"async"),w.Tb()),2&e){let e=null;w.lc("tableColumns",t.tableColumns)("inRequest",t.inRequest)("items",t.messages)("filterFields",t.filterFields)("paginator",t.paginator),w.Db(2),w.Fc(" ",w.hc(3,7,"settings.messages.tableHeader.title")," "),w.Db(2),w.lc("ngIf",(null==(e=w.hc(5,9,t.adminFacade.admin$))?null:e.role)===t.EUserRoleDto.SUPER_ADMIN)}},directives:[j.a,i.l,r.a,p.h,o.a],pipes:[l.c,i.b],encapsulation:2}),e})()},{path:":slug/edit",component:E},{path:"template/new",component:M,canActivate:[h.b]},{path:"template/:id/edit",component:M,canActivate:[h.b]}];let L=(()=>{class e{}return e.\u0275mod=w.Mb({type:e}),e.\u0275inj=w.Lb({factory:function(t){return new(t||e)},imports:[[p.i.forChild($)],p.i]}),e})(),P=(()=>{class e{}return e.\u0275mod=w.Mb({type:e}),e.\u0275inj=w.Lb({factory:function(t){return new(t||e)},imports:[[i.c,o.b,r.c,n.e,c.c,l.b,a.q,b.a,m.a,g.a,u.a,d.a,L]]}),e})()}}]);